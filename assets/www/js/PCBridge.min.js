function init(){try{ip=window.location.hostname;$("#ip").val(ip);$("#ip").textinput("disable");lista=$("#listaCompartidos").listview();$("#status1").css("color","#F08080");testWebSocket();handleReceiveButtons("disable");handleConnectButton("enable");startConnection()}catch(e){location.reload(true)}}function handleReceiveButtons(e){$("#botonRecibirNuevos").button(e);$("#botonRecibirViejos").button(e);$("#botonBorrarViejos").button(e)}function handleConnectButton(e){$("#botonConectar").button(e)}function testWebSocket(){if(!window.WebSocket){alert("WebSocket not supported :( Use an updated FireFox, Chrome or Safari")}}function alertInput(e){if(e){$("#status1").css("color","white");$(".inputColor").parent().css("background-color","white")}else{$("#status1").css("color","#F08080");$(".inputColor").parent().css("background-color","#F08080")}}function openWebSocket(){wsUri=prot+ip+port;websocket=new WebSocket(wsUri);websocket.onopen=function(e){onOpen(e)};websocket.onclose=function(e){onClose(e)};websocket.onmessage=function(e){onMessage(e)};websocket.onerror=function(e){onError(e)}}function onOpen(e){conexion=true;$("#status1").text("CONNECTED");$("#status1").css("color","#90EE90");handleReceiveButtons("enable");handleConnectButton("disable");sendMeData()}function onClose(e){conexion=false;$("#status1").text("DISCONNECTED");$("#status1").css("color","#F08080");handleReceiveButtons("disable");handleConnectButton("enable");if(websocket){websocket.close();websocket=null}}function onMessage(e){writeToScreen(e.data)}function onError(e){writeToScreen('<span style="color: red;">ERROR:</span> '+e.data)}function doSend(e){try{websocket.send(e)}catch(t){}}function writeToScreen(e){lista.empty();lista.append();lista.listview("refresh");if(e){try{var t=JSON&&JSON.parse(e)||$.parseJSON(e);if(t.listado.length!=0){t.listado.forEach(function(e){var t=e.split(" ");var n=false;for(var r in t){if(t[r].indexOf("http://")!=-1||t[r].indexOf("https://")!=-1){var i;if(t[r].indexOf("http",1)!=-1){i=t[r].substring(t[r].indexOf("http"),t[r].length)}else{i=t[r]}lista.append('<li><a target="_blank" href="'+i+'"><font style="white-space:wrap; font-size: small" >'+e.replace(/\n/g,"<br/>")+"</font></a></li>");n=true}}if(!n){lista.append('<li data-icon="false">'+e.replace(/\n/g,"<br/>")+"</li>")}})}else{lista.append('<li data-icon="false" style="text-align: center; letter-spacing:10px;">'+"NO CONTENT :("+"</li>")}}catch(n){return}}else{console.log("no hay mensaje :(")}lista.listview("refresh");receivedData()}function startConnection(){if(isEmpty(ip)){alertInput(false)}else{alertInput(true);openWebSocket();sendMeData()}}function isEmpty(e){return!e||0===e.length}function receivedData(){doSend("OK RECEIVED")}function sendMeData(){doSend("OK OPEN")}function sendMeNews(){if(websocket){websocket.send("OK OPEN")}else{websocket=null;openWebSocket()}}function sendMeHist(){if(websocket){websocket.send("HIST")}else{websocket=null;openWebSocket()}}function deleteHist(){if(websocket){websocket.send("HIST_DEL")}else{websocket=null;openWebSocket()}}function noClearHistory(){$("#popupBasic").popup("close")}function yesClearHistory(){try{deleteHist()}catch(e){}finally{$("#popupBasic").popup("close")}}function deleteHistBtt(){$("#popupBasic").popup("open")}var prot="ws://",ip="",port=":8887/",wsUri=prot+ip+port,lista,conexion,websocket;window.addEventListener("load",init,false)